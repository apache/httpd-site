<html>
<head>
  <link rel="stylesheet" type="text/css" href="dox.css" />
  <title>libapreq2-2.13: libapreq2: Apache2::Upload</title> 
</head>
<body>
<div id="page-header">
<p class="menu">
   <a href="http://www.apache.org/">Apache Software Foundation</a> &gt; <a href="http://httpd.apache.org">HTTP Server Project</a> &gt;
<a href="http://httpd.apache.org/apreq/">Request Library Subproject</a></p>
<p class="apache">Apache HTTP Server Request Library</p>
<img alt="" src="feather.gif" /></div>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>Apache2::Upload<br>
<small>
[<a class="el" href="group__apreq__xs.html">Perl</a>]</small>
</h1><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
</table>




<!-- INDEX BEGIN -->
<div name="index">
<p><a name="__index__"></a></p>

<ul>

	<li><a href="#name">NAME</a></li>
	<li><a href="#synopsis">SYNOPSIS</a></li>
	<li><a href="#description">DESCRIPTION</a></li>
	<li><a href="#apache2__upload">Apache2::Upload</a></li>
	<ul>

		<li><a href="#name">name</a></li>
		<li><a href="#filename">filename</a></li>
		<li><a href="#fh">fh</a></li>
		<li><a href="#io">io</a></li>
		<li><a href="#bb">bb</a></li>
		<li><a href="#size">size</a></li>
		<li><a href="#info">info</a></li>
		<li><a href="#type">type</a></li>
		<li><a href="#link">link</a></li>
		<li><a href="#slurp">slurp</a></li>
		<li><a href="#tempname">tempname</a></li>
	</ul>

	<li><a href="#apr__request__brigade">APR::Request::Brigade</a></li>
	<ul>

		<li><a href="#tiehandle">TIEHANDLE</a></li>
		<li><a href="#read">READ</a></li>
		<li><a href="#readline">READLINE</a></li>
	</ul>

	<li><a href="#porting_from_1_x">PORTING from 1.X</a></li>
	<li><a href="#see_also">SEE ALSO</a></li>
	<li><a href="#copyright">COPYRIGHT</a></li>
</ul>

<hr name="index" />
</div>
<!-- INDEX END -->


<p>

</p>

<h1><a name="name">NAME</a></h1>

<p>Apache2::Upload - Methods for dealing with file uploads.</p>

<p>

</p>
<hr />

<h1><a name="synopsis">SYNOPSIS</a></h1>

<pre>
    use Apache2::Upload;</pre>

<pre>
    $req = Apache2::Request-&gt;new($r);
    $upload = $req-&gt;upload(&quot;foo&quot;);
    $size = $upload-&gt;size;</pre>

<pre>
    # three methods to get at the upload's contents ... slurp, fh, io</pre>

<pre>
    $upload-&gt;slurp($slurp_data);</pre>

<pre>
    read $upload-&gt;fh, $fh_data, $size;
    ok $slurp_data eq $fh_data;</pre>

<pre>
    my $io = $upload-&gt;io;
    print while &lt;$io&gt;;</pre>

<p>

</p>
<hr />

<h1><a name="description">DESCRIPTION</a></h1>

<p>Apache2::Upload is a new module based on the original package included
in Apache2::Request 1.X.  Users requiring the upload API must now
<code>use Apache2::Upload</code>, which adds the <code>upload</code> method to Apache2::Request.
Apache2::Upload is largely backwards-compatible with the original 1.X API.
See the <a href="#porting_from_1_x">PORTING from 1.X</a> section below for a list of known issues.</p>

<p>This manpage documents the Apache2::Upload package.</p>

<p>

</p>
<hr />

<h1><a name="apache2__upload">Apache2::Upload</a></h1>

<p>

</p>

<h2><a name="name">name</a></h2>

<pre>
    $upload-&gt;name()</pre>

<p>The name of the HTML form element which generated the upload.</p>

<p>

</p>

<h2><a name="filename">filename</a></h2>

<pre>
    $upload-&gt;filename()</pre>

<p>The (client-side) filename as submitted in the HTML form.  Note:
some agents will submit the file's full pathname, while others
may submit just the basename.</p>

<p>

</p>

<h2><a name="fh">fh</a></h2>

<pre>
    $upload-&gt;fh()</pre>

<p>Creates filehandle reference to the upload's spooled tempfile,
which contains the full contents of the upload.</p>

<p>

</p>

<h2><a name="io">io</a></h2>

<pre>
    $upload-&gt;io()</pre>

<p>Creates a tied IO handle.  This method is a more efficient version
of <code>fh</code>, but with <code>io</code> the handle ref returned is not seekable.
It is tied to an APR::Request::Brigade object, so you may use the
brigade API on the tied object if you want to manipulate the IO stream
(beyond simply reading from it).</p>

<p>The returned reference is actually an object which has <code>read</code> and
<code>readline</code> methods available.  However these methods are just
syntactic sugar for the underlying <code>READ</code> and <code>READLINE</code> methods from
APR::Request::Brigade.</p>

<pre>
    $io = $upload-&gt;io;
    print while $io-&gt;read($_); # equivalent to: tied(*$io)-&gt;READ($_)</pre>

<p>See <a href="#read">READ</a> and <a href="#readline">READLINE</a> below for additional notes
on their usage.</p>

<p>

</p>

<h2><a name="bb">bb</a></h2>

<pre>
    $upload-&gt;bb()
    $upload-&gt;bb($set)</pre>

<p>Get/set the APR::Brigade which represents the upload's contents.</p>

<p>

</p>

<h2><a name="size">size</a></h2>

<pre>
    $upload-&gt;size()</pre>

<p>Returns the size of the upload in bytes.</p>

<p>

</p>

<h2><a name="info">info</a></h2>

<pre>
    $upload-&gt;info()
    $upload-&gt;info($set)</pre>

<p>Get/set the additional header information table for the
uploaded file.
Returns a hash reference tied to the <em>APR::Table</em> class.
An optional <code>$table</code> argument can be passed to reassign
the upload's internal (apr_table_t) info table to the one
<code>$table</code> represents.</p>

<pre>
    my $info = $upload-&gt;info;
    while (my($hdr_name, $hdr_value) = each %$info) {
        # ...
    }</pre>

<pre>
    # fetch upload's Content-Type header
    my $type = $upload-&gt;info-&gt;{&quot;Content-type&quot;};</pre>

<p>

</p>

<h2><a name="type">type</a></h2>

<pre>
    $upload-&gt;type()</pre>

<p>Returns the MIME type of the given <em>Apache2::Upload</em> object.</p>

<pre>
    my $type = $upload-&gt;type;</pre>

<pre>
    #same as
    my $content_type = $upload-&gt;info-&gt;{&quot;Content-Type&quot;};
    $content_type =~ s/;.*$//ms;</pre>

<p>

</p>

<h2><a name="link">link</a></h2>

<pre>
    $upload-&gt;link()</pre>

<p>To avoid recopying the upload's internal tempfile brigade on a
*nix-like system, <em>link</em> will create a hard link to it:</p>

<pre>
  my $upload = $req-&gt;upload('foo');
  $upload-&gt;link(&quot;/path/to/newfile&quot;) or
      die sprintf &quot;link from '%s' failed: $!&quot;, $upload-&gt;tempname;</pre>

<p>Typically the new name must lie on the same device and partition
as the brigade's tempfile.  If this or any other reason prevents
the OS from linking the files, <code>link()</code> will instead
copy the temporary file to the specified location.</p>

<p>

</p>

<h2><a name="slurp">slurp</a></h2>

<pre>
    $upload-&gt;slurp($contents)</pre>

<p>Reads the full contents of a file upload into the scalar argument.
The return value is the length of the file.</p>

<pre>
    my $size = $upload-&gt;slurp($contents);</pre>

<p>

</p>

<h2><a name="tempname">tempname</a></h2>

<pre>
    $upload-&gt;tempname()</pre>

<p>Provides the name of the spool file.</p>

<pre>
    my $tempname = $upload-&gt;tempname;</pre>

<p>

</p>
<hr />

<h1><a name="apr__request__brigade">APR::Request::Brigade</a></h1>

<p>This class is derived from APR::Brigade, providing additional
methods for TIEHANDLE, READ and READLINE.  To be memory efficient,
these methods delete buckets from the brigade as soon as their
data is actually read, so you cannot <code>seek</code> on handles tied to
this class.  Such handles have semantics similar to that of a
read-only socket.</p>

<p>

</p>

<h2><a name="tiehandle">TIEHANDLE</a></h2>

<pre>
    APR::Request::Brigade-&gt;TIEHANDLE($bb)</pre>

<p>Creates a copy of the bucket brigade represented by $bb, and
blesses that copy into the APR::Request::Brigade class.  This
provides syntactic sugar for using perl's builtin <code>read</code>, <code>readline</code>,
and <code>&lt;&gt;</code> operations on handles tied to this package:</p>

<pre>
    use Symbol;
    $fh = gensym;
    tie *$fh, &quot;APR::Request:Brigade&quot;, $bb;
    print while &lt;$fh&gt;;</pre>

<p>

</p>

<h2><a name="read">READ</a></h2>

<pre>
    $bb-&gt;READ($contents)
    $bb-&gt;READ($contents, $length)
    $bb-&gt;READ($contents, $length, $offset)</pre>

<p>Reads data from the brigade $bb into $contents.  When omitted
$length defaults to <code>-1</code>, which reads the first bucket into $contents.
A positive $length will read in $length bytes, or the remainder of the
brigade, whichever is greater. $offset represents the index in $context
to read the new data.</p>

<p>

</p>

<h2><a name="readline">READLINE</a></h2>

<pre>
    $bb-&gt;READLINE()</pre>

<p>Returns the first line of data from the bride. Lines are terminated by
linefeeds (the '\012' character), but we may eventually use <code>$/</code> instead.</p>

<p>

</p>
<hr />

<h1><a name="porting_from_1_x">PORTING from 1.X</a></h1>

<ul>

<li>
<strong>
<a name="next" class="item"><code>$upload-&gt;next()</code> is no longer available;  please use the
<code>APR::Request::Param::Table</code> API when iterating over upload entries.</a>
</strong>



<li>
<strong>
<a name="info" class="item"><code>info($header_name)</code> is replaced by <code>info($set)</code>.</a>
</strong>



<li>
<strong>
<a name="type" class="item"><code>type()</code> returns only the MIME-type portion of the Content-Type header.</a>
</strong>



</ul>


<p>

</p>
<hr />

<h1><a name="see_also">SEE ALSO</a></h1>

<p><a href="group__apreq__xs__apr__request.html">the APR::Request::Param::Table manpage</a>, <a href="group__apreq__xs__apr__request__error.html">the APR::Request::Error manpage</a>, <a href="group__apreq__xs__request.html">the Apache2::Request manpage</a>,
APR::Table(3)</p>

<p>

</p>
<hr />

<h1><a name="copyright">COPYRIGHT</a></h1>

<pre>
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the &quot;License&quot;); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at</pre>

<pre>
      <a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></pre>

<pre>
  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.</pre>


 </div>
<div id="footer">
<p class="apache">
Copyright &copy; 2003-2006 <a href="http://www.apache.org">The Apache Software Foundation</a>.<br/>
See <a href="apreq_license.html">LICENSE</a>.</p>
<p class="menu">
<span style="color:#aaa">page generated by <a href="http://www.doxygen.org/"><code>doxygen</code></a>
version 1.5.6 on 3 Dec 2010</span>
</p>
</div>
</body>
</html>
